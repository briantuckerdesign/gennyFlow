function gennyFlow(){const flowList=$('[gf="wrapper"]').find('[gf="capture"]');let flowID=1,flowSettings=[{attribute:"format",variableName:"fileFormat",value:"png",type:"string"},{attribute:"quality",variableName:"fileQuality",value:1,type:"number"},{attribute:"scale",variableName:"fileScale",value:1,type:"number"},{attribute:"zip-name",variableName:"zipName",value:"images",type:"string"},{attribute:"disable-svg-fix",variableName:"disableSVGfix",value:!1,type:"boolean"},{attribute:"include-date-zip",variableName:"includeDateZip",value:!1,type:"boolean"},{attribute:"include-scale-zip",variableName:"includeScaleZip",value:!1,type:"boolean"},{attribute:"include-date-img",variableName:"includeDateImg",value:!1,type:"boolean"},{attribute:"include-scale-img",variableName:"includeScaleImg",value:!1,type:"boolean"}];function convertToSlug(input){return input=(input=(input=input.toLowerCase()).replace(/[^a-z0-9_ -]/g,"")).replace(/\s+/g,"-")}if(flowSettings.forEach(setting=>{let variableName=setting.variableName,variableSafeName=setting.variableName+"Safe",userValue=$('[gf="'+setting.attribute+'-input"]').val(),wrapperValue=$('[gf="wrapper"]').attr(`gf-${setting.attribute}`),variableValue=userValue||(wrapperValue||setting.value);"number"===setting.type?variableValue=parseFloat(variableValue):"boolean"===setting.type?variableValue="true"===variableValue:"string"===setting.type&&(variableValue=String(variableValue)),window[variableName]=variableValue,window[variableSafeName]=variableValue}),!1===disableSVGfix){const imgs=document.querySelectorAll('div[gf=wrapper] img[src$=".svg"]:not([gf=ignore])');var svgElements;imgs.forEach(img=>{img.classList.add("gf_img2svg")}),inlineSVG.init({svgSelector:"img.gf_img2svg",initClass:"js-inlinesvg"}),document.body.querySelectorAll("svg.gf_img2svg").forEach((function(item){item.setAttribute("width",item.getBoundingClientRect().width),item.setAttribute("height",item.getBoundingClientRect().height)}))}const ignoreElements=document.querySelectorAll('[gf="ignore"]');ignoreElements.forEach(element=>{element.setAttribute("data-html2canvas-ignore","true")});let date=String((new Date).getMonth()+1).padStart(2,"0")+String((new Date).getDate()).padStart(2,"0")+(new Date).getFullYear().toString().slice(-2);const jsZipInstance=new JSZip,storedFlowLabels=[];let zipScale=includeScaleZip?`_@${fileScale}x`:"",zipDate=includeDateZip?`_${date}`:"",zipLabel=`${zipName}${zipScale}${zipDate}.zip`;for(const flowItem of flowList){flowSettings.forEach(setting=>{let itemAttributeValue=flowItem.getAttribute(`gf-${setting.attribute}`);if(itemAttributeValue){let variableName=setting.variableName,variableValue=itemAttributeValue;window[variableName]=variableValue}else{let variableName=setting.variableName,variableSafeName=setting.variableName+"Safe";window[variableName]=window[variableSafeName]}});let fileMime="jpg"===fileFormat?"image/jpeg":`image/${fileFormat}`;const slugFromHTML=convertToSlug($(flowItem).find('[gf="slug"]').html());let imgName=slugFromHTML||`img-${flowID}`,imgScale=`_@${fileScale}x`;"true"!=includeScaleImg&&(imgScale="");let imgDate=`_${date}`;"true"!=includeDateImg&&(imgDate="");let fileLabel=`${imgName}${imgScale}${imgDate}.${fileFormat}`;storedFlowLabels.includes(imgName)&&(fileLabel=`${imgName}-${flowID}${imgScale}${imgDate}.${fileFormat}`),storedFlowLabels.push(imgName),setTimeout((async function(){const canvas=await html2canvas(flowItem,{scale:fileScale,backgroundColor:null,allowTaint:!0,useCORS:!0});if(1===flowList.length)canvas.toBlob(blob=>{window.saveAs(blob,fileLabel)},fileMime,parseFloat(fileQuality));else{const flowDataURL=canvas.toDataURL(fileMime,parseFloat(fileQuality)),flowImg=document.createElement("img");flowImg.src=flowDataURL,jsZipInstance.file(fileLabel,flowImg.src.slice(flowImg.src.indexOf(",")+1),{base64:!0}),flowID===flowList.length&&jsZipInstance.generateAsync({type:"blob"},(function updateCallback(metadata){})).then(content=>{saveAs(content,zipLabel)}).catch(err=>{console.log(err)})}flowID++}),500)}}$("[gf=trigger]").click(()=>gennyFlow());