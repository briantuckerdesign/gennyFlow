async function gennyFlow(){const flowList=$('[gf="wrapper"]').find('[gf="capture"]');$(".gf_loader").css("display","block"),$(".gf_loader-message").html(`Capturing ${flowList.length} items...`),console.log(`\n    gennyFlow v3.0.2\n    Running on ${flowList.length} items.  \n    `);const flowSettings={format:{attribute:"format",variableName:"fileFormat",default:"png",type:"string"},quality:{attribute:"quality",variableName:"fileQuality",default:1,type:"number"},scale:{attribute:"scale",variableName:"fileScale",default:1,type:"number"},zipName:{attribute:"zip-name",variableName:"zipName",default:"images",type:"string"},disableSVGfix:{attribute:"disable-svg-fix",variableName:"disableSVGfix",default:!1,type:"boolean"},includeDateZip:{attribute:"include-date-zip",variableName:"includeDateZip",default:!0,type:"boolean"},includeScaleZip:{attribute:"include-scale-zip",variableName:"includeScaleZip",default:!0,type:"boolean"},includeDateImg:{attribute:"include-date-img",variableName:"includeDateImg",default:!1,type:"boolean"},includeScaleImg:{attribute:"include-scale-img",variableName:"includeScaleImg",default:!1,type:"boolean"}},settings={};if(Object.keys(flowSettings).forEach(settingKey=>{const setting=flowSettings[settingKey];let variableName=setting.variableName;const userValue=$(`[gf="${setting.attribute}-input"]`).val(),wrapperValue=$('[gf="wrapper"]').attr(`gf-${setting.attribute}`);let variableValue=userValue||wrapperValue||setting.default;settings[variableName]=variableValue}),!settings.disableSVGfix){$(".gf_loader-message").html("Making it pop...");const imgs=document.querySelectorAll('div[gf=wrapper] img[src$=".svg"]:not([gf=ignore])');var svgElements;imgs.forEach(img=>{img.classList.add("gf_img2svg")}),inlineSVG.init({svgSelector:"img.gf_img2svg",initClass:"js-inlinesvg"}),document.body.querySelectorAll("svg.gf_img2svg").forEach((function(item){item.setAttribute("width",item.getBoundingClientRect().width),item.setAttribute("height",item.getBoundingClientRect().height)}))}function convertToSlug(input){return input=(input=(input=input.toLowerCase()).replace(/[^a-z0-9_ -]/g,"")).replace(/\s+/g,"-")}let date=String((new Date).getMonth()+1).padStart(2,"0")+String((new Date).getDate()).padStart(2,"0")+(new Date).getFullYear().toString().slice(-2);const ignoreElements=document.querySelectorAll('[gf="ignore"]');ignoreElements.forEach(element=>{element.setAttribute("data-html2canvas-ignore","true")});const jsZipInstance=new JSZip,storedFlowLabels=[];let zipScale=settings.includeScaleZip?`_@${settings.fileScale}x`:"",zipDate=settings.includeDateZip?`_${date}`:"",zipName=convertToSlug(settings.zipName),zipLabel=`${zipName}${zipScale}${zipDate}.zip`;await new Promise(resolve=>setTimeout(resolve,100));for(let i=0;i<flowList.length;i++){let item=flowList[i],flowID=i+1,itemSettings={};Object.keys(flowSettings).forEach(settingKey=>{const setting=flowSettings[settingKey];let itemAttributeValue=$(item).attr(`gf-${setting.attribute}`);itemAttributeValue&&(itemSettings[setting.variableName]=itemAttributeValue)});let finalFormat=itemSettings.fileFormat||settings.fileFormat,finalQuality=itemSettings.fileQuality||settings.fileQuality,finalScale=itemSettings.fileScale||settings.fileScale,includeScaleImg=itemSettings.includeScaleImg||settings.includeScaleImg,includeDateImg=itemSettings.includeDateImg||settings.includeDateImg,fileMime="jpg"===finalFormat?"image/jpeg":`image/${finalFormat}`;const slugFromHTMLunformatted=$(item).find('[gf="slug"]').html();let slugFromHTML=convertToSlug(slugFromHTMLunformatted),imgName=slugFromHTML||`img-${flowID}`;console.log("finalquality",finalQuality),console.log("fileMime",fileMime),$(".gf_loader-message").html(`Capturing ${imgName}...`);let imgScale="";"true"===includeScaleImg&&(imgScale=`_@${finalScale}x`);let imgDate="";"true"===includeDateImg&&(imgDate=`_${date}x`);let fileLabel=`${imgName}${imgDate}${imgScale}.${finalFormat}`;storedFlowLabels.includes(fileLabel)&&(fileLabel=`${imgName}-${flowID}${imgDate}${imgScale}.${finalFormat}`),storedFlowLabels.push(fileLabel);const canvas=await html2canvas(item,{scale:finalScale,allowTaint:!0,useCORS:!0,backgroundColor:null});if(1===flowList.length)return void canvas.toBlob((function(blob){window.saveAs(blob,fileLabel),$(".gf_loader").css("display","none")}),fileMime,finalQuality);const flowDataURL=canvas.toDataURL(fileMime,finalQuality),flowImg=document.createElement("img");flowImg.src=flowDataURL,jsZipInstance.file(fileLabel,flowImg.src.slice(flowImg.src.indexOf(",")+1),{base64:!0}),flowID===flowList.length&&($(".gf_loader-message").html("Zipping it all up..."),jsZipInstance.generateAsync({type:"blob"},(function updateCallback(metadata){})).then(content=>{saveAs(content,zipLabel),$(".gf_loader").css("display","none"),console.log(`\n${storedFlowLabels.length} files saved.\nSettings used:\n- Zip name: ${zipName}.zip\n- File format: .${finalFormat}\n- File quality: ${finalQuality}/1\n- File scale: @${finalScale}x\n- Include scale in image name: ${includeScaleImg}\n- Include date in image name: ${includeDateImg}\n- Include date in zip name: ${settings.includeDateZip}\n- Include scale in zip name: ${settings.includeScaleZip}\n        `)}).catch(err=>{console.log(err)})),itemSettings={}}}$("[gf=trigger]").click(()=>gennyFlow());